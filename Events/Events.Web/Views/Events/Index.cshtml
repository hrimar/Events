@model Events.Web.Models.EventsPageViewModel

@{
    ViewData["Title"] = Model.PageTitle;
}

<!-- Filters Section -->
<section class="filters-section bg-light py-4">
    <div class="container">
        <form method="get" class="row g-3">
            <!-- Search -->
            <div class="col-md-4">
                <label for="search" class="form-label">Search Events</label>
                <input type="text" class="form-control" id="search" name="search" 
                       value="@Model.SearchTerm" placeholder="Search by name, location...">
            </div>
            
            <!-- Category -->
            <div class="col-md-2">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" name="category">
                    <option value="">All Categories</option>
                    @foreach(var cat in EventsPageViewModel.AvailableCategories)
                    {
                        <option value="@cat.Value" selected="@(Model.CurrentCategory == cat.Value)">
                            @cat.DisplayName
                        </option>
                    }
                </select>
            </div>
            
            <!-- Free Events -->
            <div class="col-md-2">
                <label for="free" class="form-label">Price</label>
                <select class="form-select" id="free" name="free">
                    <option value="">All Events</option>
                    <option value="true" selected="@(Model.IsFreeFilter == true)">Free Only</option>
                    <option value="false" selected="@(Model.IsFreeFilter == false)">Paid Only</option>
                </select>
            </div>
            
            <!-- Date From -->
            <div class="col-md-2">
                <label for="fromDate" class="form-label">From Date</label>
                <input type="date" class="form-control" id="fromDate" name="fromDate" 
                       value="@Model.FromDate?.ToString("yyyy-MM-dd")">
            </div>
            
            <!-- Actions -->
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="fas fa-search"></i> Search
                </button>
                @if(Model.HasActiveFilters)
                {
                    <a href="/Events" class="btn btn-outline-secondary">
                        <i class="fas fa-times"></i> Clear
                    </a>
                }
            </div>
        </form>
    </div>
</section>

<!-- Results Section -->
<section class="py-4">
    <div class="container">
        <!-- Results Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2>@Model.PageTitle</h2>
                @if(Model.HasActiveFilters)
                {
                    <p class="text-muted mb-0">
                        Filtered results 
                        @if(!string.IsNullOrEmpty(Model.CurrentCategory))
                        {
                            <span class="badge bg-primary">@Model.CurrentCategory</span>
                        }
                        @if(Model.IsFreeFilter == true)
                        {
                            <span class="badge bg-success">Free Events</span>
                        }
                    </p>
                }
            </div>
            <small class="text-muted">
                Showing @((Model.Events.CurrentPage - 1) * Model.Events.PageSize + 1) - 
                @Math.Min(Model.Events.CurrentPage * Model.Events.PageSize, Model.Events.TotalCount) 
                of @Model.Events.TotalCount events
            </small>
        </div>
        
        <!-- Events Grid -->
        <div class="row">
            @if(Model.Events.Items.Any())
            {
                @foreach(var eventItem in Model.Events.Items)
                {
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card event-card h-100">
                            <a href="@Url.Action("Details", "Events", new { id = eventItem.Id })" class="text-decoration-none">
                                <div class="event-image-container">
                                    <img src="@eventItem.DefaultImage" 
                                         alt="@eventItem.Name" 
                                         class="event-image-full"
                                         onerror="this.src='/images/default-event.jpg'">
                                    <div class="event-price @(eventItem.IsFree ? "event-free" : "")">
                                        @eventItem.PriceDisplay
                                    </div>
                                </div>
                            </a>
                            
                            <div class="card-body d-flex flex-column">
                                <h5 class="event-title">
                                    <a href="@Url.Action("Details", "Events", new { id = eventItem.Id })" class="text-decoration-none text-dark">
                                        @eventItem.Name
                                    </a>
                                </h5>
                                <div class="event-date mb-2">
                                    <i class="fas fa-calendar me-1"></i>
                                    @eventItem.FormattedDate @eventItem.FormattedTime
                                </div>
                                <div class="event-venue mb-2">
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    @eventItem.Location
                                </div>
                                
                                @if(!string.IsNullOrEmpty(eventItem.CategoryName))
                                {
                                    <div class="mb-2">
                                        <a href="@Url.Action("Category", "Events", new { category = eventItem.CategoryName })" class="badge bg-secondary text-decoration-none">
                                            @eventItem.CategoryName
                                        </a>
                                        @if(!string.IsNullOrEmpty(eventItem.SubCategoryName))
                                        {
                                            <span class="badge bg-light text-dark ms-1">@eventItem.SubCategoryName</span>
                                        }
                                    </div>
                                }
                                
                                @if(eventItem.Tags.Any())
                                {
                                    <div class="event-tags mb-2">
                                        @foreach(var tag in eventItem.Tags.Take(3))
                                        {
                                            <span class="badge bg-info text-dark me-1">@tag</span>
                                        }
                                    </div>
                                }
                                
                                @if(!string.IsNullOrEmpty(eventItem.ShortDescription))
                                {
                                    <p class="text-muted small flex-grow-1">@eventItem.ShortDescription</p>
                                }
                            </div>
                            
                            <div class="card-footer bg-transparent">
                                <div class="d-flex justify-content-between">
                                    <a href="@Url.Action("Details", "Events", new { id = eventItem.Id })" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-info-circle me-1"></i>Details
                                    </a>
                                    @if(eventItem.HasTicketUrl)
                                    {
                                        <a href="@eventItem.TicketUrl" target="_blank" class="btn btn-primary btn-sm">
                                            <i class="fas fa-ticket-alt me-1"></i>Buy tickets
                                        </a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center py-5">
                    <i class="fas fa-calendar-times text-muted" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 text-muted">No events found</h4>
                    <p class="text-muted">Try adjusting your search criteria or browse all events.</p>
                    <a href="/Events" class="btn btn-primary">View All Events</a>
                </div>
            }
        </div>
        
        <!-- Pagination -->
        @if(Model.Events.TotalPages > 1)
        {
            <nav aria-label="Events pagination" class="mt-4">
                <ul class="pagination justify-content-center">
                    @if(Model.Events.HasPreviousPage)
                    {
                        <li class="page-item">
                            <a class="page-link" href="?page=@(Model.Events.CurrentPage - 1)&@Model.FiltersQueryString">
                                <i class="fas fa-chevron-left"></i> Previous
                            </a>
                        </li>
                    }
                    
                    @for(var i = Math.Max(1, Model.Events.CurrentPage - 2); i <= Math.Min(Model.Events.TotalPages, Model.Events.CurrentPage + 2); i++)
                    {
                        <li class="page-item @(i == Model.Events.CurrentPage ? "active" : "")">
                            <a class="page-link" href="?page=@i&@Model.FiltersQueryString">@i</a>
                        </li>
                    }
                    
                    @if(Model.Events.HasNextPage)
                    {
                        <li class="page-item">
                            <a class="page-link" href="?page=@(Model.Events.CurrentPage + 1)&@Model.FiltersQueryString">
                                Next <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    }
                </ul>
            </nav>
        }
    </div>
</section>